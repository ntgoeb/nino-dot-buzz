<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nino's webhome</title>
    <link rel="stylesheet" href="style/default-style.css">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav>
            <a href="index.html">Home</a>
            <a href="games.html">Games</a>
            <a href="links.html">Links</a>
        </nav>

        <!-- Main content -->
        <main>
            <h1>Nino's Webhome</h1>
            <div class="marquee">*** NINO|ONIN ***</div>
            
            <div class="under-construction">
                ðŸš§ WE ARE WORKING ON THIS PART ðŸš§
            </div>

            <p>Placeholder text</p>

            <!-- Featured Game -->
            <div class="game-container">
                <h2>Featured Game</h2>
                <div id="featured-game"></div>
                <p style="margin-top: 15px; font-size: 0.9em;"><a href="games.html">See all games &raquo;</a></p>
            </div>

            <!-- Notes Section -->
            <div class="notes-container">
                <h2>My Notes</h2>
                <textarea id="user-notes" placeholder="Write your notes here... they'll be saved in your browser!"></textarea>
                <div class="notes-footer">
                    <span id="save-status"></span>
                    <button onclick="clearNotes()">Clear Notes</button>
                </div>
            </div>

            <!-- News Section -->
            <div class="news-container">
                <h2>ðŸ“° Today's Headlines</h2>
                <ul id="news-list">
                    <li>Loading news...</li>
                </ul>
                <p class="news-sources">Sources: BBC News, NPR</p>
            </div>
        </main>

    <script>
        async function fetchRSS(url) {
            const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();
                return data.status === 'ok' ? data.items : [];
            } catch (error) {
                console.error('Error fetching RSS:', error);
                return [];
            }
        }

        async function loadNews() {
            const feeds = {
                entertainment: [
                    'https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml',
                    'https://feeds.npr.org/1008/rss.xml'
                ],
                general: [
                    'https://feeds.bbci.co.uk/news/rss.xml',
                    'https://feeds.npr.org/1001/rss.xml'
                ]
            };

            // Fetch all feeds in parallel
            const [entBBC, entNPR, genBBC, genNPR] = await Promise.all([
                fetchRSS(feeds.entertainment[0]),
                fetchRSS(feeds.entertainment[1]),
                fetchRSS(feeds.general[0]),
                fetchRSS(feeds.general[1])
            ]);

            // Tag items with their source type
            const entertainmentItems = [
                ...entBBC.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'BBC' })),
                ...entNPR.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'NPR' }))
            ];

            const generalItems = [
                ...genBBC.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'BBC' })),
                ...genNPR.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'NPR' }))
            ];

            // Pick 2 entertainment headlines (1 from each source if possible)
            const selectedEntertainment = [];
            const bbcEnt = entertainmentItems.find(i => i.source === 'BBC');
            const nprEnt = entertainmentItems.find(i => i.source === 'NPR');
            if (bbcEnt) selectedEntertainment.push(bbcEnt);
            if (nprEnt) selectedEntertainment.push(nprEnt);

            // Fill remaining entertainment slots if needed
            while (selectedEntertainment.length < 2 && entertainmentItems.length > selectedEntertainment.length) {
                const remaining = entertainmentItems.find(i => !selectedEntertainment.includes(i));
                if (remaining) selectedEntertainment.push(remaining);
                else break;
            }

            // Shuffle general items and pick 5 (excluding duplicates by title)
            const usedTitles = new Set(selectedEntertainment.map(i => i.title));
            const availableGeneral = generalItems.filter(i => !usedTitles.has(i.title));

            // Interleave sources for variety
            const selectedGeneral = [];
            let bbcIndex = 0, nprIndex = 0;
            const bbcGen = availableGeneral.filter(i => i.source === 'BBC');
            const nprGen = availableGeneral.filter(i => i.source === 'NPR');

            while (selectedGeneral.length < 5) {
                if (bbcIndex < bbcGen.length && (selectedGeneral.length % 2 === 0 || nprIndex >= nprGen.length)) {
                    selectedGeneral.push(bbcGen[bbcIndex++]);
                } else if (nprIndex < nprGen.length) {
                    selectedGeneral.push(nprGen[nprIndex++]);
                } else {
                    break;
                }
            }

            // Combine: general headlines first, then entertainment at the end
            const allHeadlines = [...selectedGeneral, ...selectedEntertainment].slice(0, 7);

            // Render the news list
            const newsList = document.getElementById('news-list');

            if (allHeadlines.length === 0) {
                newsList.innerHTML = '<li>Unable to load news. Check back later!</li>';
                return;
            }

            newsList.innerHTML = allHeadlines.map(item => {
                const label = item.type === 'entertainment' ? ' ðŸŽ¬' : '';
                return `<li><a href="${item.link}" target="_blank" rel="noopener">${item.title}</a>${label} <span class="news-source">[${item.source}]</span></li>`;
            }).join('');
        }

        // Load news when page loads
        loadNews();

        // Notes functionality
        const notesArea = document.getElementById('user-notes');
        const saveStatus = document.getElementById('save-status');
        let saveTimeout;

        // Load saved notes
        const savedNotes = localStorage.getItem('nino-notes');
        if (savedNotes) {
            notesArea.value = savedNotes;
        }

        // Auto-save on input
        notesArea.addEventListener('input', function() {
            clearTimeout(saveTimeout);
            saveStatus.textContent = 'Saving...';
            saveStatus.style.color = '#ffff00';

            saveTimeout = setTimeout(() => {
                localStorage.setItem('nino-notes', notesArea.value);
                saveStatus.textContent = 'Saved!';
                saveStatus.style.color = '#00ff00';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }, 500);
        });

        function clearNotes() {
            if (confirm('Are you sure you want to clear your notes?')) {
                notesArea.value = '';
                localStorage.removeItem('nino-notes');
                saveStatus.textContent = 'Cleared!';
                saveStatus.style.color = '#ff00ff';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }
        }

        // Featured Game - random selection on each page load
        const games = [
            {
                name: 'Hangman',
                url: 'hangman.html',
                description: 'Guess the word before the stick figure meets its fate!'
            },
            {
                name: 'Tic-Tac-Toe',
                url: 'tictactoe.html',
                description: 'Classic X\'s and O\'s - play against a friend or the computer!'
            },
            {
                name: 'Guess the Number',
                url: 'guess-number.html',
                description: 'I\'m thinking of a number between 1 and 100...'
            },
            {
                name: 'Super Star Trek',
                url: 'startrek.html',
                description: 'Command the Enterprise in this classic text-based adventure.'
            }
        ];

        const randomGame = games[Math.floor(Math.random() * games.length)];
        document.getElementById('featured-game').innerHTML = `
            <p style="font-size: 1.3em;"><a href="${randomGame.url}">${randomGame.name}</a></p>
            <p>${randomGame.description}</p>
        `;
    </script>
    </div>
</body>
</html>
