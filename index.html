<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nino's webhome</title>
    <link rel="stylesheet" href="style/default-style.css">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav>
            <a href="index.html">Home</a>
            <a href="games.html">Games</a>
            <a href="links.html">Links</a>
            <div class="music-player">
                <button id="music-btn" onclick="toggleMusic()" title="Play random music">
                    <span id="music-icon">üéµ</span>
                </button>
                <span id="now-playing"></span>
                <audio id="audio-player"></audio>
            </div>
        </nav>

        <!-- Main content -->
        <main>
            <h1>Nino's Webhome</h1>
            
            <div id="birthday-banner" class="birthday-banner" style="display: none;">
                üéÇ HAPPY BIRTHDAY NINO! üéâüéàüéÅ
            </div>

            <!-- Notes Section -->
            <div class="notes-container">
                <h2>My Notes</h2>
                <textarea id="user-notes" placeholder="Write your notes here... they'll be saved in your browser!"></textarea>
                <div class="notes-footer">
                    <span id="save-status"></span>
                    <button onclick="clearNotes()">Clear Notes</button>
                </div>
            </div>

            <!-- News Section -->
            <div class="news-container">
                <h2>üì∞ Today's Headlines</h2>
                <ul id="news-list">
                    <li>Loading news...</li>
                </ul>
            </div>
        </main>

        <footer class="site-footer">
            Music by <a href="https://incompetech.com" target="_blank" rel="noopener">Kevin MacLeod</a> (incompetech.com) - Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">CC BY 4.0</a>
        </footer>

    <script>
        async function fetchRSS(url) {
            const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();
                return data.status === 'ok' ? data.items : [];
            } catch (error) {
                console.error('Error fetching RSS:', error);
                return [];
            }
        }

        async function loadNews() {
            const feeds = {
                entertainment: [
                    'https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml',
                    'https://feeds.npr.org/1008/rss.xml'
                ],
                general: [
                    'https://feeds.bbci.co.uk/news/rss.xml',
                    'https://feeds.npr.org/1001/rss.xml'
                ],
                onion: 'https://www.theonion.com/rss'
            };

            // Fetch all feeds in parallel
            const [entBBC, entNPR, genBBC, genNPR, onionItems] = await Promise.all([
                fetchRSS(feeds.entertainment[0]),
                fetchRSS(feeds.entertainment[1]),
                fetchRSS(feeds.general[0]),
                fetchRSS(feeds.general[1]),
                fetchRSS(feeds.onion)
            ]);

            // Tag items with their source type
            const entertainmentItems = [
                ...entBBC.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'BBC' })),
                ...entNPR.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'NPR' }))
            ];

            const generalItems = [
                ...genBBC.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'BBC' })),
                ...genNPR.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'NPR' }))
            ];

            const satireItems = onionItems.slice(0, 3).map(item => ({ ...item, type: 'satire', source: 'The Onion' }));

            // Pick 2 entertainment headlines (1 from each source if possible)
            const selectedEntertainment = [];
            const bbcEnt = entertainmentItems.find(i => i.source === 'BBC');
            const nprEnt = entertainmentItems.find(i => i.source === 'NPR');
            if (bbcEnt) selectedEntertainment.push(bbcEnt);
            if (nprEnt) selectedEntertainment.push(nprEnt);

            // Fill remaining entertainment slots if needed
            while (selectedEntertainment.length < 2 && entertainmentItems.length > selectedEntertainment.length) {
                const remaining = entertainmentItems.find(i => !selectedEntertainment.includes(i));
                if (remaining) selectedEntertainment.push(remaining);
                else break;
            }

            // Pick 2 Onion headlines
            const selectedOnion = satireItems.slice(0, 2);

            // Shuffle general items and pick 5 (excluding duplicates by title)
            const usedTitles = new Set([...selectedEntertainment, ...selectedOnion].map(i => i.title));
            const availableGeneral = generalItems.filter(i => !usedTitles.has(i.title));

            // Interleave sources for variety
            const selectedGeneral = [];
            let bbcIndex = 0, nprIndex = 0;
            const bbcGen = availableGeneral.filter(i => i.source === 'BBC');
            const nprGen = availableGeneral.filter(i => i.source === 'NPR');

            while (selectedGeneral.length < 5) {
                if (bbcIndex < bbcGen.length && (selectedGeneral.length % 2 === 0 || nprIndex >= nprGen.length)) {
                    selectedGeneral.push(bbcGen[bbcIndex++]);
                } else if (nprIndex < nprGen.length) {
                    selectedGeneral.push(nprGen[nprIndex++]);
                } else {
                    break;
                }
            }

            // Combine: 5 general, then intersperse 2 Onion and 2 entertainment
            // Final order: gen, gen, onion, gen, gen, onion, gen, ent, ent (9 total)
            const allHeadlines = [];
            allHeadlines.push(selectedGeneral[0]);
            allHeadlines.push(selectedGeneral[1]);
            if (selectedOnion[0]) allHeadlines.push(selectedOnion[0]);
            allHeadlines.push(selectedGeneral[2]);
            allHeadlines.push(selectedGeneral[3]);
            if (selectedOnion[1]) allHeadlines.push(selectedOnion[1]);
            allHeadlines.push(selectedGeneral[4]);
            allHeadlines.push(...selectedEntertainment);

            // Filter out any undefined entries and limit to 9
            const finalHeadlines = allHeadlines.filter(Boolean).slice(0, 9);

            // Render the news list
            const newsList = document.getElementById('news-list');

            if (finalHeadlines.length === 0) {
                newsList.innerHTML = '<li>Unable to load news. Check back later!</li>';
                return;
            }

            newsList.innerHTML = finalHeadlines.map(item => {
                return `<li><a href="${item.link}" target="_blank" rel="noopener">${item.title}</a> <span class="news-source">[${item.source}]</span></li>`;
            }).join('');
        }

        // Load news when page loads
        loadNews();

        // Show birthday banner on February 4th
        (function() {
            const today = new Date();
            if (today.getMonth() === 1 && today.getDate() === 4) {
                document.getElementById('birthday-banner').style.display = 'block';
            }
        })();

        // Notes functionality
        const notesArea = document.getElementById('user-notes');
        const saveStatus = document.getElementById('save-status');
        let saveTimeout;

        // Load saved notes
        const savedNotes = localStorage.getItem('nino-notes');
        if (savedNotes) {
            notesArea.value = savedNotes;
        }

        // Auto-save on input
        notesArea.addEventListener('input', function() {
            clearTimeout(saveTimeout);
            saveStatus.textContent = 'Saving...';
            saveStatus.style.color = '#ffff00';

            saveTimeout = setTimeout(() => {
                localStorage.setItem('nino-notes', notesArea.value);
                saveStatus.textContent = 'Saved!';
                saveStatus.style.color = '#00ff00';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }, 500);
        });

        function clearNotes() {
            if (confirm('Are you sure you want to clear your notes?')) {
                notesArea.value = '';
                localStorage.removeItem('nino-notes');
                saveStatus.textContent = 'Cleared!';
                saveStatus.style.color = '#ff00ff';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }
        }

        // Music Player
        const musicTracks = [
            '8bit_Dungeon_Level.mp3',
            'Bit_Quest.mp3',
            'Carefree.mp3',
            'Chipper_Doodle.mp3',
            'Crypto.mp3',
            'Digital_Lemonade.mp3',
            'Disco_Medusae.mp3',
            'Electrodoodle.mp3',
            'Fluffing_a_Duck.mp3',
            'Funky_Chunk.mp3',
            'Hard_Boiled.mp3',
            'Hyperfun.mp3',
            'Investigations.mp3',
            'Monkeys_Spinning_Monkeys.mp3',
            'Neon_Laser_Horizon.mp3',
            'Pinball_Spring.mp3',
            'Pixelland.mp3',
            'Quirky_Dog.mp3',
            'Run_Amok.mp3',
            'Sneaky_Snitch.mp3',
            'Space_Fighter_Loop.mp3',
            'Spy_Glass.mp3',
            'Super_Friendly.mp3',
            'The_Builder.mp3',
            'Wallpaper.mp3',
            'Your_Call.mp3'
        ];

        const audioPlayer = document.getElementById('audio-player');
        const musicIcon = document.getElementById('music-icon');
        const nowPlaying = document.getElementById('now-playing');
        let isPlaying = false;

        function playRandomTrack() {
            const track = musicTracks[Math.floor(Math.random() * musicTracks.length)];
            audioPlayer.src = 'music/' + track;
            audioPlayer.play();
            nowPlaying.textContent = track;
            isPlaying = true;
            musicIcon.textContent = '‚è∏Ô∏è';
        }

        function toggleMusic() {
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                musicIcon.textContent = '‚ñ∂Ô∏è';
            } else {
                playRandomTrack();
            }
        }

        // Play next random track when current one ends
        audioPlayer.addEventListener('ended', playRandomTrack);
    </script>
    </div>
    <script type="module" src="js/analytics.js"></script>
</body>
</html>
