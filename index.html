<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <title>Nino's webhome</title>
    <link rel="stylesheet" href="style/default-style.css">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav>
            <a href="index.html">Home</a>
            <a href="games.html">Games</a>
            <a href="links.html">Links</a>
            <div class="music-player">
                <button id="music-btn" onclick="toggleMusic()" title="Play random music">
                    <span id="music-icon">üéµ</span>
                </button>
                <span id="now-playing"></span>
                <audio id="audio-player"></audio>
            </div>
        </nav>

        <!-- Main content -->
        <main>
            <h1>Nino's Webhome</h1>
            
            <div id="birthday-banner" class="birthday-banner" style="display: none;">
                <span class="running-man-container">
                    <span class="running-man">
                        <span class="head"></span>
                        <span class="body"></span>
                        <span class="arm arm-left"></span>
                        <span class="arm arm-right"></span>
                        <span class="leg leg-left"></span>
                        <span class="leg leg-right"></span>
                    </span>
                </span>
                üéÇ HAPPY BIRTHDAY NINO! üéâ
            </div>

            <!-- Notes Section -->
            <div class="notes-container">
                <h2>My Notes</h2>
                <textarea id="user-notes" placeholder="Write your notes here... they'll be saved in your browser!"></textarea>
                <div class="notes-footer">
                    <span id="save-status"></span>
                    <button onclick="clearNotes()">Clear Notes</button>
                </div>
            </div>

            <!-- Horoscope Section -->
            <div class="horoscope-container">
                <h2>üîÆ Daily Horoscope</h2>
                <div class="horoscope-controls">
                    <label for="zodiac-select">Your Sign:</label>
                    <select id="zodiac-select" onchange="fetchHoroscope()">
                        <option value="">-- Select --</option>
                        <option value="Aries">‚ôà Aries (Mar 21 - Apr 19)</option>
                        <option value="Taurus">‚ôâ Taurus (Apr 20 - May 20)</option>
                        <option value="Gemini">‚ôä Gemini (May 21 - Jun 20)</option>
                        <option value="Cancer">‚ôã Cancer (Jun 21 - Jul 22)</option>
                        <option value="Leo">‚ôå Leo (Jul 23 - Aug 22)</option>
                        <option value="Virgo">‚ôç Virgo (Aug 23 - Sep 22)</option>
                        <option value="Libra">‚ôé Libra (Sep 23 - Oct 22)</option>
                        <option value="Scorpio">‚ôè Scorpio (Oct 23 - Nov 21)</option>
                        <option value="Sagittarius">‚ôê Sagittarius (Nov 22 - Dec 21)</option>
                        <option value="Capricorn">‚ôë Capricorn (Dec 22 - Jan 19)</option>
                        <option value="Aquarius">‚ôí Aquarius (Jan 20 - Feb 18)</option>
                        <option value="Pisces">‚ôì Pisces (Feb 19 - Mar 20)</option>
                    </select>
                </div>
                <div id="horoscope-content">
                    <p class="horoscope-prompt">Select your zodiac sign to reveal today's horoscope...</p>
                </div>
            </div>

            <!-- Moon Phase Section -->
            <div class="moon-container">
                <h2>üåô Moon Phase</h2>
                <p class="moon-display">
                    The moon is currently... <span id="moon-icon">üåë</span> <span id="moon-phase-text">Loading...</span>
                </p>
            </div>

            <!-- Random Wikipedia Section -->
            <div class="wiki-container">
                <a href="https://en.wikipedia.org/wiki/Special:Random" target="_blank" rel="noopener" class="wiki-button">
                    üé≤ Random Wikipedia Article... click me!
                </a>
            </div>

            <!-- News Section -->
            <div class="news-container">
                <h2 class="news-toggle" onclick="toggleNews()">
                    <span id="news-toggle-icon">‚ñ∂</span> Today's Headlines üì∞
                </h2>
                <div id="news-content" style="display: none;">
                    <ul id="news-list">
                        <li>Loading news...</li>
                    </ul>
                </div>
            </div>

            <!-- Visitor Counter -->
            <div class="visitor-container">
                <span>You are </span><span class="visitor-label">VISITOR #</span><span id="visitor-count" class="visitor-number">...</span>
            </div>
        </main>

        <footer class="site-footer">
            Music by <a href="https://incompetech.com" target="_blank" rel="noopener">Kevin MacLeod</a> (incompetech.com) - Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">CC BY 4.0</a>
        </footer>

    <script>
        async function fetchRSS(url) {
            const proxyUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl);
                const data = await response.json();
                return data.status === 'ok' ? data.items : [];
            } catch (error) {
                console.error('Error fetching RSS:', error);
                return [];
            }
        }

        async function loadNews() {
            const feeds = {
                entertainment: [
                    'https://feeds.bbci.co.uk/news/entertainment_and_arts/rss.xml',
                    'https://feeds.npr.org/1008/rss.xml'
                ],
                general: [
                    'https://feeds.bbci.co.uk/news/rss.xml',
                    'https://feeds.npr.org/1001/rss.xml'
                ],
                onion: 'https://www.theonion.com/rss'
            };

            // Fetch all feeds in parallel
            const [entBBC, entNPR, genBBC, genNPR, onionItems] = await Promise.all([
                fetchRSS(feeds.entertainment[0]),
                fetchRSS(feeds.entertainment[1]),
                fetchRSS(feeds.general[0]),
                fetchRSS(feeds.general[1]),
                fetchRSS(feeds.onion)
            ]);

            // Tag items with their source type
            const entertainmentItems = [
                ...entBBC.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'BBC' })),
                ...entNPR.slice(0, 3).map(item => ({ ...item, type: 'entertainment', source: 'NPR' }))
            ];

            const generalItems = [
                ...genBBC.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'BBC' })),
                ...genNPR.slice(0, 5).map(item => ({ ...item, type: 'general', source: 'NPR' }))
            ];

            const satireItems = onionItems.slice(0, 3).map(item => ({ ...item, type: 'satire', source: 'The Onion' }));

            // Pick 2 entertainment headlines (1 from each source if possible)
            const selectedEntertainment = [];
            const bbcEnt = entertainmentItems.find(i => i.source === 'BBC');
            const nprEnt = entertainmentItems.find(i => i.source === 'NPR');
            if (bbcEnt) selectedEntertainment.push(bbcEnt);
            if (nprEnt) selectedEntertainment.push(nprEnt);

            // Fill remaining entertainment slots if needed
            while (selectedEntertainment.length < 2 && entertainmentItems.length > selectedEntertainment.length) {
                const remaining = entertainmentItems.find(i => !selectedEntertainment.includes(i));
                if (remaining) selectedEntertainment.push(remaining);
                else break;
            }

            // Pick 2 Onion headlines
            const selectedOnion = satireItems.slice(0, 2);

            // Shuffle general items and pick 5 (excluding duplicates by title)
            const usedTitles = new Set([...selectedEntertainment, ...selectedOnion].map(i => i.title));
            const availableGeneral = generalItems.filter(i => !usedTitles.has(i.title));

            // Interleave sources for variety
            const selectedGeneral = [];
            let bbcIndex = 0, nprIndex = 0;
            const bbcGen = availableGeneral.filter(i => i.source === 'BBC');
            const nprGen = availableGeneral.filter(i => i.source === 'NPR');

            while (selectedGeneral.length < 5) {
                if (bbcIndex < bbcGen.length && (selectedGeneral.length % 2 === 0 || nprIndex >= nprGen.length)) {
                    selectedGeneral.push(bbcGen[bbcIndex++]);
                } else if (nprIndex < nprGen.length) {
                    selectedGeneral.push(nprGen[nprIndex++]);
                } else {
                    break;
                }
            }

            // Combine: 5 general, then intersperse 2 Onion and 2 entertainment
            // Final order: gen, gen, onion, gen, gen, onion, gen, ent, ent (9 total)
            const allHeadlines = [];
            allHeadlines.push(selectedGeneral[0]);
            allHeadlines.push(selectedGeneral[1]);
            if (selectedOnion[0]) allHeadlines.push(selectedOnion[0]);
            allHeadlines.push(selectedGeneral[2]);
            allHeadlines.push(selectedGeneral[3]);
            if (selectedOnion[1]) allHeadlines.push(selectedOnion[1]);
            allHeadlines.push(selectedGeneral[4]);
            allHeadlines.push(...selectedEntertainment);

            // Filter out any undefined entries and limit to 9
            const finalHeadlines = allHeadlines.filter(Boolean).slice(0, 9);

            // Render the news list
            const newsList = document.getElementById('news-list');

            if (finalHeadlines.length === 0) {
                newsList.innerHTML = '<li>Unable to load news. Check back later!</li>';
                return;
            }

            newsList.innerHTML = '';
            finalHeadlines.forEach(item => {
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = item.link;
                link.target = '_blank';
                link.rel = 'noopener';
                link.textContent = item.title;

                const sourceSpan = document.createElement('span');
                sourceSpan.className = 'news-source';
                sourceSpan.textContent = '[' + item.source + ']';

                li.appendChild(link);
                li.appendChild(document.createTextNode(' '));
                li.appendChild(sourceSpan);
                newsList.appendChild(li);
            });
        }

        // Load news when page loads
        loadNews();

        // Horoscope functionality
        const zodiacSelect = document.getElementById('zodiac-select');
        const horoscopeContent = document.getElementById('horoscope-content');

        // Load saved zodiac sign
        const savedSign = localStorage.getItem('nino-zodiac-sign');
        if (savedSign) {
            zodiacSelect.value = savedSign;
            fetchHoroscope();
        }

        async function fetchHoroscope() {
            const sign = zodiacSelect.value;
            if (!sign) {
                horoscopeContent.innerHTML = '<p class="horoscope-prompt">Select your zodiac sign to reveal today\'s horoscope...</p>';
                localStorage.removeItem('nino-zodiac-sign');
                return;
            }

            // Save the selection
            localStorage.setItem('nino-zodiac-sign', sign);

            // Show loading state
            horoscopeContent.innerHTML = '<p class="horoscope-loading">Consulting the stars...</p>';

            try {
                const apiUrl = `https://horoscope-app-api.vercel.app/api/v1/get-horoscope/daily?sign=${sign}&day=TODAY`;
                const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`);
                const data = await response.json();

                if (data.success && data.data) {
                    const horoscopeText = document.createElement('p');
                    horoscopeText.className = 'horoscope-text';
                    horoscopeText.textContent = data.data.horoscope_data;

                    const horoscopeDate = document.createElement('p');
                    horoscopeDate.className = 'horoscope-date';
                    horoscopeDate.textContent = data.data.date;

                    horoscopeContent.innerHTML = '';
                    horoscopeContent.appendChild(horoscopeText);
                    horoscopeContent.appendChild(horoscopeDate);
                } else {
                    horoscopeContent.innerHTML = '<p class="horoscope-error">The stars are unclear... try again later.</p>';
                }
            } catch (error) {
                console.error('Error fetching horoscope:', error);
                horoscopeContent.innerHTML = '<p class="horoscope-error">The cosmic connection failed. Try again later!</p>';
            }
        }

        // Show birthday banner Feb 3-4 (Eastern Time)
        (function() {
            const etDate = new Date().toLocaleDateString('en-US', { timeZone: 'America/New_York' });
            const [month, day] = etDate.split('/').map(Number);
            if (month === 2 && (day === 3 || day === 4)) {
                document.getElementById('birthday-banner').style.display = 'block';
            }
        })();

        // Notes functionality
        const notesArea = document.getElementById('user-notes');
        const saveStatus = document.getElementById('save-status');
        let saveTimeout;

        // Load saved notes
        const savedNotes = localStorage.getItem('nino-notes');
        if (savedNotes) {
            notesArea.value = savedNotes;
        }

        // Auto-save on input
        notesArea.addEventListener('input', function() {
            clearTimeout(saveTimeout);
            saveStatus.textContent = 'Saving...';
            saveStatus.style.color = '#ffff00';

            saveTimeout = setTimeout(() => {
                localStorage.setItem('nino-notes', notesArea.value);
                saveStatus.textContent = 'Saved!';
                saveStatus.style.color = '#00ff00';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }, 500);
        });

        function clearNotes() {
            if (confirm('Are you sure you want to clear your notes?')) {
                notesArea.value = '';
                localStorage.removeItem('nino-notes');
                saveStatus.textContent = 'Cleared!';
                saveStatus.style.color = '#ff00ff';
                setTimeout(() => {
                    saveStatus.textContent = '';
                }, 2000);
            }
        }

        // Music Player
        const musicTracks = [
            '8bit_Dungeon_Level.mp3',
            'Bit_Quest.mp3',
            'Carefree.mp3',
            'Chipper_Doodle.mp3',
            'Crypto.mp3',
            'Digital_Lemonade.mp3',
            'Disco_Medusae.mp3',
            'Electrodoodle.mp3',
            'Fluffing_a_Duck.mp3',
            'Funky_Chunk.mp3',
            'Hard_Boiled.mp3',
            'Hyperfun.mp3',
            'Investigations.mp3',
            'Monkeys_Spinning_Monkeys.mp3',
            'Neon_Laser_Horizon.mp3',
            'Pinball_Spring.mp3',
            'Pixelland.mp3',
            'Quirky_Dog.mp3',
            'Run_Amok.mp3',
            'Sneaky_Snitch.mp3',
            'Space_Fighter_Loop.mp3',
            'Spy_Glass.mp3',
            'Super_Friendly.mp3',
            'The_Builder.mp3',
            'Wallpaper.mp3',
            'Your_Call.mp3'
        ];

        const audioPlayer = document.getElementById('audio-player');
        const musicIcon = document.getElementById('music-icon');
        const nowPlaying = document.getElementById('now-playing');
        let isPlaying = false;

        function playRandomTrack() {
            const track = musicTracks[Math.floor(Math.random() * musicTracks.length)];
            audioPlayer.src = 'music/' + track;
            audioPlayer.play();
            nowPlaying.textContent = track;
            isPlaying = true;
            musicIcon.textContent = '‚è∏Ô∏è';
        }

        function toggleMusic() {
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
                musicIcon.textContent = '‚ñ∂Ô∏è';
            } else {
                playRandomTrack();
            }
        }

        // Play next random track when current one ends
        audioPlayer.addEventListener('ended', playRandomTrack);

        // News toggle functionality (collapsed by default)
        let newsExpanded = false;
        function toggleNews() {
            const newsContent = document.getElementById('news-content');
            const toggleIcon = document.getElementById('news-toggle-icon');
            newsExpanded = !newsExpanded;
            newsContent.style.display = newsExpanded ? 'block' : 'none';
            toggleIcon.textContent = newsExpanded ? '‚ñº' : '‚ñ∂';
        }

        // Moon phase calculator
        function getMoonPhase() {
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();

            // Calculate days since known new moon (Jan 6, 2000)
            const lp = 2551443; // Lunar period in seconds
            const now = new Date(year, month - 1, day, 20, 35, 0);
            const newMoon = new Date(2000, 0, 6, 18, 14, 0);
            const phase = ((now.getTime() - newMoon.getTime()) / 1000) % lp;
            const phaseDay = Math.floor(phase / (24 * 3600));

            // Moon phase names and icons
            const phases = [
                { name: 'New Moon', icon: 'üåë' },
                { name: 'Waxing Crescent', icon: 'üåí' },
                { name: 'First Quarter', icon: 'üåì' },
                { name: 'Waxing Gibbous', icon: 'üåî' },
                { name: 'Full Moon', icon: 'üåï' },
                { name: 'Waning Gibbous', icon: 'üåñ' },
                { name: 'Last Quarter', icon: 'üåó' },
                { name: 'Waning Crescent', icon: 'üåò' }
            ];

            const index = Math.floor((phaseDay / 29.53) * 8) % 8;
            return phases[index];
        }

        // Update moon phase display
        const moonPhase = getMoonPhase();
        document.getElementById('moon-icon').textContent = moonPhase.icon;
        document.getElementById('moon-phase-text').textContent = moonPhase.name;

        // Visitor counter (uses localStorage + offset)
        function updateVisitorCount() {
            const OFFSET = 8653;
            let count = parseInt(localStorage.getItem('nino-visit-count') || '0');

            // Check if this is a new session
            const lastVisit = sessionStorage.getItem('nino-visited');
            if (!lastVisit) {
                count++;
                localStorage.setItem('nino-visit-count', count.toString());
                sessionStorage.setItem('nino-visited', 'true');
            }

            const displayCount = count + OFFSET;
            document.getElementById('visitor-count').textContent = displayCount.toLocaleString();
        }
        updateVisitorCount();
    </script>
    </div>
    <script type="module" src="js/analytics.js"></script>
</body>
</html>
